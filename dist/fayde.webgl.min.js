var Fayde;!function(e){var r;!function(e){e.version="0.1.3"}(r=e.WebGL||(e.WebGL={}))}(Fayde||(Fayde={}));var __extends=this&&this.__extends||function(e,r){function t(){this.constructor=e}for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n]);e.prototype=null===r?Object.create(r):(t.prototype=r.prototype,new t)},Fayde;!function(e){var r;!function(r){var t=function(e){function t(){e.call(this),this.Init=new nullstone.Event,this.Draw=new nullstone.Event,this.DefaultStyleKey=t}return __extends(t,e),t.prototype.CreateLayoutUpdater=function(){return new fayde.webgl.updater.WebGLCanvasUpdater},t.prototype.OnSourceChanged=function(e,r){var t=this;e&&e.detach(),r&&r.attach(function(e,r){return t.OnInit(e,r)},function(e,r,n,a){return t.OnDraw(e,r,n,a)})},t.prototype.OnInit=function(e,t){var n=this;if(this.XamlNode.IsAttached)this.Init.raise(this,new r.WebGLInitEventArgs(e,t));else var a=this.XamlNode.MonitorIsAttached(function(r){n.OnInit(e,t),a.Detach()})},t.prototype.OnDraw=function(e,t,n,a){this.Draw.raise(this,new r.WebGLDrawEventArgs(e,t,n,a))},t.SourceProperty=DependencyProperty.Register("Source",function(){return r.WebGLSource},t,void 0,function(e,r){return e.OnSourceChanged(r.OldValue,r.NewValue)}),t}(e.FrameworkElement);r.WebGLCanvas=t,e.CoreLibrary.add(t),e.Markup.Content(t,t.SourceProperty);var n;!function(r){e.UIReaction(t.SourceProperty,function(e,r,t,n){n.OnSourceChanged(r,t)},!1)}(n||(n={}))}(r=e.WebGL||(e.WebGL={}))}(Fayde||(Fayde={}));var Fayde;!function(e){var r;!function(e){var r=function(){function e(e,r,t,n){Object.defineProperties(this,{gl:{value:e,writable:!1},program:{value:r,writable:!1},width:{value:t,writable:!1},height:{value:n,writable:!1}})}return e}();e.WebGLDrawEventArgs=r}(r=e.WebGL||(e.WebGL={}))}(Fayde||(Fayde={}));var Fayde;!function(e){var r;!function(e){var r=function(){function e(e,r){Object.defineProperties(this,{gl:{value:e,writable:!1},program:{value:r,writable:!1}})}return e}();e.WebGLInitEventArgs=r}(r=e.WebGL||(e.WebGL={}))}(Fayde||(Fayde={}));var Fayde;!function(e){var r;!function(r){var t=function(e){function r(){e.call(this),this.$loaded=!1,this.$setElement(document.createElement("canvas")),this.$tryLoad()}return __extends(r,e),r.prototype.$setElement=function(e){this.$gl=e.getContext("webgl")||e.getContext("experimental-webgl"),this.$tryLoad()},r.prototype.$tryLoad=function(){this.$loaded||(this.init(this.$gl,this.$program=this.$gl.createProgram()),this.$loaded=!0)},r.prototype.resize=function(e,r){var t=this.$gl.canvas;this.$gl.viewport(0,0,e,r),t.width=e,t.height=r},r.prototype.init=function(e,r){this.$onInit&&this.$onInit(e,r)},r.prototype.draw=function(e){if(this.$loaded){var r=this.$gl.canvas;this.$onDraw&&this.$onDraw(this.$gl,this.$program,r.width,r.height),e.drawImage(r,0,0)}},r.prototype.detach=function(){this.$onInit=null,this.$onDraw=null},r.prototype.attach=function(e,r){this.$onInit=e,this.$onDraw=r,this.$loaded&&this.init(this.$gl,this.$program)},r}(e.DependencyObject);r.WebGLSourceBase=t}(r=e.WebGL||(e.WebGL={}))}(Fayde||(Fayde={}));var Fayde;!function(e){var r;!function(e){var r=function(r){function t(){r.apply(this,arguments)}return __extends(t,r),t.prototype.OnVertexShaderChanged=function(e,r){var t=this;r&&r.load().then(function(){return t.$tryLoad()},function(e){return console.error("Could not load vertex shader.",e)})},t.prototype.OnFragmentShaderChanged=function(e,r){var t=this;r&&r.load().then(function(){return t.$tryLoad()},function(e){return console.error("Could not load fragment shader.",e)})},t.prototype.$tryLoad=function(){if(!this.$loaded){var e=this.VertexShader,r=this.FragmentShader;e&&r&&e.IsLoaded&&r.IsLoaded&&(this.init(this.$gl,this.$program=this.$gl.createProgram()),this.$loaded=!0)}},t.prototype.init=function(e,r){var t=this.VertexShader;t.compile(e),t.use(e,r);var n=this.FragmentShader;return n.compile(e),n.use(e,r),e.linkProgram(r),e.getProgramParameter(r,e.LINK_STATUS)?(e.useProgram(r),void(this.$onInit&&this.$onInit(this.$gl,this.$program))):void console.warn("Could not link webgl program.",e.getProgramInfoLog(r))},t.VertexShaderProperty=DependencyProperty.Register("VertexShader",function(){return e.VertexShader},t,void 0,function(e,r){return e.OnVertexShaderChanged(r.OldValue,r.NewValue)}),t.FragmentShaderProperty=DependencyProperty.Register("FragmentShader",function(){return e.FragmentShader},t,void 0,function(e,r){return e.OnFragmentShaderChanged(r.OldValue,r.NewValue)}),t}(e.WebGLSourceBase);e.WebGLSource=r}(r=e.WebGL||(e.WebGL={}))}(Fayde||(Fayde={}));var Fayde;!function(e){var r;!function(r){var t;!function(e){e[e.NotLoaded=0]="NotLoaded",e[e.Loaded=1]="Loaded",e[e.LoadFailed=2]="LoadFailed",e[e.Loading=3]="Loading"}(t||(t={}));var n=function(r){function n(){r.apply(this,arguments),this.$shader=null,this.$loadStatus=t.NotLoaded,this.$loadErr=null,this.$compiled=!1}return __extends(n,r),n.prototype.OnSourceChanged=function(e,r){this.$compiled=!1,this.$loadStatus!==t.Loading&&this.SetCurrentValue(n.UriProperty,void 0),r?(this.$loadStatus=t.Loaded,this.SetCurrentValue(n.IsLoadedProperty,!0)):(this.$loadStatus=t.NotLoaded,this.SetCurrentValue(n.IsLoadedProperty,!1))},n.prototype.OnUriChanged=function(e,r){this.$compiled=!1,r&&this.SetCurrentValue(n.SourceProperty,void 0)},n.prototype.load=function(r){var a=this;if(r===!0&&this.SetCurrentValue(n.SourceProperty,void 0),this.$loadStatus===t.Loaded)return Promise.resolve(this);if(this.$loadStatus===t.LoadFailed)return Promise.reject(this.$loadErr);var i=this.Uri;return e.Uri.isNullOrEmpty(i)?Promise.reject("Cannot load shader if no Uri is specified."):(this.$loadStatus=t.Loading,this.$loadErr=null,new Promise(function(e,r){require(["text!"+a.Uri],function(r){a.SetCurrentValue(n.SourceProperty,r),e(a)},function(e){a.$loadStatus=t.LoadFailed,r(a.$loadErr=e)})}))},n.prototype.compile=function(e){if(this.$compiled)return!0;var r=this.Source;if(!r)return!1;var t=this.$shader=e.createShader(this.getType(e));if(e.shaderSource(t,r),e.compileShader(t),!e.getShaderParameter(t,e.COMPILE_STATUS))throw console.error("An error occurred compiling the shaders.",e.getShaderInfoLog(t)),new Error("An error occurred compiling the shaders.");return this.$compiled=!0,!0},n.prototype.use=function(e,r){e.attachShader(r,this.$shader)},n.prototype.getType=function(e){return-1},n.SourceProperty=DependencyProperty.Register("Source",function(){return String},n,void 0,function(e,r){return e.OnSourceChanged(r.OldValue,r.NewValue)}),n.UriProperty=DependencyProperty.Register("Uri",function(){return e.Uri},n,void 0,function(e,r){return e.OnUriChanged(r.OldValue,r.NewValue)}),n.IsLoadedProperty=DependencyProperty.Register("IsLoaded",function(){return Boolean},n,!1),n}(e.DependencyObject);r.ShaderBase=n,e.Markup.Content(n,n.SourceProperty)}(r=e.WebGL||(e.WebGL={}))}(Fayde||(Fayde={}));var Fayde;!function(e){var r;!function(e){var r=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.prototype.getType=function(e){return e.FRAGMENT_SHADER},r}(e.ShaderBase);e.FragmentShader=r}(r=e.WebGL||(e.WebGL={}))}(Fayde||(Fayde={}));var Fayde;!function(e){var r;!function(e){var r=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.prototype.getType=function(e){return e.VERTEX_SHADER},r}(e.ShaderBase);e.VertexShader=r}(r=e.WebGL||(e.WebGL={}))}(Fayde||(Fayde={}));var Fayde;!function(e){var r;!function(r){function t(t,n){n instanceof r.ShaderBase?t.Source=n.Source:n instanceof e.Uri?t.Uri=n:"string"==typeof n&&(t.Uri=new e.Uri(n))}nullstone.registerTypeConverter(r.FragmentShader,function(e){if(!e)return e;if(e instanceof r.FragmentShader)return e;var n=new r.FragmentShader;return t(n,e),n}),nullstone.registerTypeConverter(r.VertexShader,function(e){if(!e)return e;if(e instanceof r.VertexShader)return e;var n=new r.VertexShader;return t(n,e),n})}(r=e.WebGL||(e.WebGL={}))}(Fayde||(Fayde={}));var fayde;!function(e){var r;!function(e){var r;!function(e){var r=function(r){function t(){r.apply(this,arguments)}return __extends(t,r),t.prototype.init=function(){this.setMeasurePipe(minerva.singleton(e.measure.WebGLCanvasMeasurePipeDef)).setArrangePipe(minerva.singleton(e.arrange.WebGLCanvasArrangePipeDef)).setProcessDownPipe(minerva.singleton(minerva.controls.canvas.processdown.CanvasProcessDownPipeDef)).setProcessUpPipe(minerva.singleton(minerva.controls.canvas.processup.CanvasProcessUpPipeDef)).setRenderPipe(minerva.singleton(e.render.WebGLCanvasRenderPipeDef));var t=this.assets;t.source=null,r.prototype.init.call(this)},t.prototype.onSurfaceChanged=function(e,r){e&&e.unhookPrerender(this),r&&r.hookPrerender(this)},t.prototype.preRender=function(){var e=this.assets;e.source&&this.invalidate()},t.prototype.onSizeChanged=function(e,t){r.prototype.onSizeChanged.call(this,e,t);var n=this.assets.source;n&&n.resize(t.width,t.height)},t}(minerva.core.Updater);e.WebGLCanvasUpdater=r}(r=e.updater||(e.updater={}))}(r=e.webgl||(e.webgl={}))}(fayde||(fayde={}));var fayde;!function(e){var r;!function(e){var r;!function(e){var r;!function(e){var r=function(r){function t(){r.call(this),this.replaceTapin("doOverride",e.tapins.doOverride).replaceTapin("buildLayoutClip",e.tapins.buildLayoutClip)}return __extends(t,r),t}(minerva.core.arrange.ArrangePipeDef);e.WebGLCanvasArrangePipeDef=r}(r=e.arrange||(e.arrange={}))}(r=e.updater||(e.updater={}))}(r=e.webgl||(e.webgl={}))}(fayde||(fayde={}));var fayde;!function(e){var r;!function(e){var r;!function(e){var r;!function(e){var r=function(r){function t(){r.call(this),this.replaceTapin("doOverride",e.tapins.doOverride)}return __extends(t,r),t}(minerva.core.measure.MeasurePipeDef);e.WebGLCanvasMeasurePipeDef=r}(r=e.measure||(e.measure={}))}(r=e.updater||(e.updater={}))}(r=e.webgl||(e.webgl={}))}(fayde||(fayde={}));var fayde;!function(e){var r;!function(e){var r;!function(e){var r;!function(e){var r=function(r){function t(){r.call(this),this.replaceTapin("doRender",e.tapins.doRender)}return __extends(t,r),t}(minerva.core.render.RenderPipeDef);e.WebGLCanvasRenderPipeDef=r}(r=e.render||(e.render={}))}(r=e.updater||(e.updater={}))}(r=e.webgl||(e.webgl={}))}(fayde||(fayde={}));var fayde;!function(e){var r;!function(e){var r;!function(e){var r;!function(e){var r;!function(e){function r(e,r,t,n,a){var i=t.layoutClip;return i.x=i.y=i.width=i.height=0,!0}e.buildLayoutClip=r}(r=e.tapins||(e.tapins={}))}(r=e.arrange||(e.arrange={}))}(r=e.updater||(e.updater={}))}(r=e.webgl||(e.webgl={}))}(fayde||(fayde={}));var fayde;!function(e){var r;!function(e){var r;!function(e){var r;!function(e){var r;!function(e){function r(e,r,t,n,a){r.childRect;return Size.copyTo(r.finalSize,r.arrangedSize),!0}e.doOverride=r}(r=e.tapins||(e.tapins={}))}(r=e.arrange||(e.arrange={}))}(r=e.updater||(e.updater={}))}(r=e.webgl||(e.webgl={}))}(fayde||(fayde={}));var fayde;!function(e){var r;!function(e){var r;!function(e){var r;!function(e){var r;!function(e){function r(e,r,t,n,a){var i=(r.availableSize,t.desiredSize);return i.width=i.height=0,!0}e.doOverride=r}(r=e.tapins||(e.tapins={}))}(r=e.measure||(e.measure={}))}(r=e.updater||(e.updater={}))}(r=e.webgl||(e.webgl={}))}(fayde||(fayde={}));var fayde;!function(e){var r;!function(e){var r;!function(e){var r;!function(e){var r;!function(e){function r(e,r,t,n,a,i){var o=e.source;return o?(n.save(),minerva.core.helpers.renderLayoutClip(n,e,i),o.draw(n.raw),n.restore(),!0):!0}e.doRender=r}(r=e.tapins||(e.tapins={}))}(r=e.render||(e.render={}))}(r=e.updater||(e.updater={}))}(r=e.webgl||(e.webgl={}))}(fayde||(fayde={}));
//# sourceMappingURL=fayde.webgl.min.js.map
